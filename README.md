# Backoffice Ve√≠culos API

API completa para gest√£o de an√∫ncios e vendas de ve√≠culos do sistema de E-commerce de Ve√≠culos. Sistema em produ√ß√£o com todas as funcionalidades CRUD implementadas e testadas.

## üöÄ Tecnologias

- **Node.js 18+** - Runtime JavaScript
- **TypeScript** - Linguagem de programa√ß√£o
- **Express.js** - Framework web
- **MongoDB** - Banco de dados
- **Mongoose** - ODM para MongoDB
- **JWT** - Autentica√ß√£o (expira√ß√£o 4h)
- **Joi** - Valida√ß√£o de dados
- **Swagger** - Documenta√ß√£o interativa da API
- **Jest** - Testes unit√°rios
- **Railway** - Deploy em produ√ß√£o

## üìã Funcionalidades Implementadas

### üöó Gest√£o de Ve√≠culos ‚úÖ
- **CRUD completo** - Criar, listar, buscar, atualizar e deletar ve√≠culos
- **Filtros avan√ßados** - Por marca, modelo, ano, pre√ßo, categoria, combust√≠vel
- **Valida√ß√£o robusta** - Schemas Joi para todos os campos obrigat√≥rios
- **Controle de status** - Ativo, vendido, inativo
- **Estat√≠sticas** - Relat√≥rios de ve√≠culos por categoria, marca, etc.
- **Pagina√ß√£o** - Sistema de pagina√ß√£o para listagens grandes

### üë• Gest√£o de Usu√°rios ‚úÖ
- **Autentica√ß√£o JWT** - Login seguro com token de 4 horas
- **Controle de roles** - Admin, manager, seller com permiss√µes espec√≠ficas
- **Perfil de usu√°rio** - Visualiza√ß√£o e edi√ß√£o de dados pessoais
- **Gest√£o administrativa** - CRUD completo de usu√°rios (admin)
- **Valida√ß√£o de dados** - Email √∫nico, senhas seguras

### üí∞ Gest√£o de Vendas ‚úÖ
- **Registro de vendas** - Sistema completo de registro de transa√ß√µes
- **C√°lculo autom√°tico** - Comiss√µes de 5% calculadas automaticamente
- **Relat√≥rios detalhados** - Estat√≠sticas por vendedor, per√≠odo, status
- **Controle de status** - Pending, completed, cancelled
- **M√©todos de pagamento** - Cash, financing, trade-in
- **Hist√≥rico completo** - Snapshot do ve√≠culo no momento da venda

### üîß Funcionalidades T√©cnicas ‚úÖ
- **Encoding UTF-8** - Suporte completo a caracteres especiais (sem acentos)
- **Valida√ß√£o de dados** - Schemas Joi para todos os endpoints
- **Tratamento de erros** - Middleware centralizado de tratamento de erros
- **Rate limiting** - Prote√ß√£o contra spam e ataques
- **CORS configurado** - Suporte a m√∫ltiplas origens
- **Health check** - Endpoint de monitoramento da API

## üåê URLs de Produ√ß√£o

- **API**: https://backoffice-veiculos-api-production.up.railway.app/
- **Documenta√ß√£o Swagger**: https://backoffice-veiculos-api-production.up.railway.app/docs
- **Health Check**: https://backoffice-veiculos-api-production.up.railway.app/health

## üõ†Ô∏è Instala√ß√£o Local

### Pr√©-requisitos
- Node.js 18+ 
- MongoDB 5+ (ou usar Railway MongoDB)
- npm ou yarn

### Configura√ß√£o

1. **Clone o reposit√≥rio**
```bash
git clone <repository-url>
cd backoffice-veiculos-api
```

2. **Instale as depend√™ncias**
```bash
npm install
```

3. **Configure as vari√°veis de ambiente**
```bash
# Para desenvolvimento local
PORT=3016
NODE_ENV=development
DATABASE_URL=mongodb://localhost:27017/backoffice-veiculos
JWT_SECRET=your-super-secret-jwt-key-here
CORS_ORIGIN=http://localhost:3000
RATE_LIMIT_MAX_REQUESTS=1000
LOG_LEVEL=info
```

4. **Execute o projeto**
```bash
# Desenvolvimento
npm run dev

# Produ√ß√£o
npm run build
npm start
```

### üöÄ Deploy no Railway

O projeto est√° configurado para deploy autom√°tico no Railway:

1. **Conecte o reposit√≥rio** ao Railway
2. **Configure as vari√°veis de ambiente**:
   - `DATABASE_URL` - MongoDB URI do Railway
   - `JWT_SECRET` - Chave secreta para JWT
   - `CORS_ORIGIN` - URL do frontend/BFF
   - `NODE_ENV=production`
3. **Deploy autom√°tico** - Railway detecta o Dockerfile e faz o build

## üìö Documenta√ß√£o da API

Acesse a documenta√ß√£o interativa da API em:
- **Produ√ß√£o**: https://backoffice-veiculos-api-production.up.railway.app/docs
- **Desenvolvimento**: http://localhost:3016/docs
- **Swagger UI**: Interface completa com exemplos e testes

### üîë Credenciais de Teste

**Usu√°rio Admin:**
- Email: `admin@backoffice.com`
- Senha: `Admin123!@#`
- Role: `admin` (acesso total)

### Endpoints Implementados

#### üöó Ve√≠culos ‚úÖ
- `GET /api/vehicles` - Listar ve√≠culos com filtros e pagina√ß√£o
- `POST /api/vehicles` - Criar ve√≠culo (autenticado)
- `GET /api/vehicles/:id` - Buscar ve√≠culo por ID
- `PUT /api/vehicles/:id` - Atualizar ve√≠culo (autenticado)
- `DELETE /api/vehicles/:id` - Deletar ve√≠culo (autenticado)
- `GET /api/vehicles/stats` - Estat√≠sticas de ve√≠culos

#### üë• Usu√°rios ‚úÖ
- `POST /api/users/register` - Registrar usu√°rio
- `POST /api/users/login` - Login (retorna JWT)
- `GET /api/users/profile` - Perfil do usu√°rio (autenticado)
- `PUT /api/users/profile` - Atualizar perfil (autenticado)
- `GET /api/users` - Listar usu√°rios (admin)
- `GET /api/users/:id` - Buscar usu√°rio (admin)
- `PUT /api/users/:id` - Atualizar usu√°rio (admin)
- `DELETE /api/users/:id` - Deletar usu√°rio (admin)

#### üí∞ Vendas ‚úÖ
- `POST /api/sales` - Registrar venda (autenticado)
- `GET /api/sales` - Listar vendas com filtros (autenticado)
- `GET /api/sales/stats` - Estat√≠sticas de vendas (autenticado)
- `GET /api/sales/my-sales` - Vendas do vendedor (autenticado)
- `GET /api/sales/:id` - Buscar venda por ID (autenticado)
- `PUT /api/sales/:id` - Atualizar venda (autenticado)
- `DELETE /api/sales/:id` - Deletar venda (admin)

#### üîß Utilit√°rios ‚úÖ
- `GET /health` - Health check da API
- `GET /docs` - Documenta√ß√£o Swagger

## üîê Autentica√ß√£o

A API utiliza JWT (JSON Web Tokens) para autentica√ß√£o com **expira√ß√£o de 4 horas**.

### Headers necess√°rios:
```
Authorization: Bearer <token>
Content-Type: application/json
```

### Roles dispon√≠veis:
- **admin**: Acesso total ao sistema (CRUD completo)
- **manager**: Gest√£o de ve√≠culos e vendas
- **seller**: Gest√£o de pr√≥prios ve√≠culos e vendas

### ‚ö†Ô∏è Importante - Encoding de Dados

**Para evitar problemas de encoding, use apenas caracteres sem acentos:**
- ‚úÖ Correto: "Veiculo em excelente estado, unico dono, revisoes em dia"
- ‚ùå Evitar: "Ve√≠culo em excelente estado, √∫nico dono, revis√µes em dia"

A API processa dados sem caracteres especiais para garantir compatibilidade total.

## üß™ Testes e Valida√ß√£o

### Status dos Testes ‚úÖ
- **CRUD de Ve√≠culos**: Testado e funcionando
- **CRUD de Usu√°rios**: Testado e funcionando  
- **CRUD de Vendas**: Testado e funcionando
- **Autentica√ß√£o JWT**: Testado e funcionando
- **Valida√ß√£o de Dados**: Testado e funcionando

### Scripts Dispon√≠veis

```bash
npm run dev          # Desenvolvimento com hot reload
npm run build        # Build para produ√ß√£o (TypeScript + tsc-alias)
npm start           # Executar em produ√ß√£o
npm test            # Executar testes
npm run lint        # Verificar c√≥digo
npm run lint:fix    # Corrigir problemas de lint
```

### Testes Manuais Realizados ‚úÖ
- ‚úÖ Login e autentica√ß√£o JWT
- ‚úÖ Cria√ß√£o de ve√≠culos com valida√ß√£o
- ‚úÖ Listagem com filtros e pagina√ß√£o
- ‚úÖ Atualiza√ß√£o e exclus√£o de ve√≠culos
- ‚úÖ Cria√ß√£o de vendas com c√°lculo de comiss√£o
- ‚úÖ Estat√≠sticas de vendas
- ‚úÖ Health check da API

## üèóÔ∏è Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ config/          # Configura√ß√µes (DB, app, swagger)
‚îú‚îÄ‚îÄ controllers/     # L√≥gica de neg√≥cio (vehicles, users, sales)
‚îú‚îÄ‚îÄ middleware/      # Middlewares (auth, validation, error)
‚îú‚îÄ‚îÄ models/          # Modelos do MongoDB (Vehicle, User, Sale)
‚îú‚îÄ‚îÄ routes/          # Defini√ß√£o de rotas com Swagger
‚îú‚îÄ‚îÄ types/           # Interfaces TypeScript
‚îú‚îÄ‚îÄ utils/           # Utilit√°rios e schemas de valida√ß√£o
‚îú‚îÄ‚îÄ tests/           # Testes unit√°rios
‚îú‚îÄ‚îÄ app.ts           # Configura√ß√£o do Express
‚îî‚îÄ‚îÄ index.ts         # Ponto de entrada
```

## üîß Configura√ß√£o de Desenvolvimento

### Vari√°veis de Ambiente

| Vari√°vel | Descri√ß√£o | Padr√£o | Produ√ß√£o |
|----------|-----------|---------|----------|
| `PORT` | Porta do servidor | 3016 | 3000 |
| `NODE_ENV` | Ambiente | development | production |
| `DATABASE_URL` | URI do MongoDB | mongodb://localhost:27017/backoffice-veiculos | Railway MongoDB |
| `JWT_SECRET` | Chave secreta JWT | - | Configurado |
| `CORS_ORIGIN` | Origem CORS | http://localhost:3000 | Frontend URL |
| `RATE_LIMIT_MAX_REQUESTS` | Limite de requests | 1000 | 1000 |
| `LOG_LEVEL` | N√≠vel de log | info | info |

### Banco de Dados

O projeto utiliza MongoDB com Mongoose. Em produ√ß√£o, usa o MongoDB gerenciado do Railway.

## üöÄ Deploy

### Railway (Produ√ß√£o Atual) ‚úÖ
O projeto est√° em produ√ß√£o no Railway com:
- **Deploy autom√°tico** via Git
- **MongoDB gerenciado** pelo Railway
- **Dockerfile** para build otimizado
- **Vari√°veis de ambiente** configuradas
- **Health check** autom√°tico

### Docker Local
```bash
# Build da imagem
docker build -t backoffice-veiculos-api .

# Executar container
docker run -p 3016:3016 --env-file .env backoffice-veiculos-api
```

### PM2
```bash
# Build do projeto
npm run build

# Instalar PM2
npm install -g pm2

# Executar com PM2
pm2 start dist/index.js --name backoffice-api
```

## üìà Monitoramento

- **Health Check**: `GET /health` - Status da API
- **Logs**: Morgan para logging HTTP detalhado
- **Rate Limiting**: 1000 requests por 15 minutos
- **CORS**: Configura√ß√£o flex√≠vel de origens
- **JWT**: Tokens com expira√ß√£o de 4 horas
- **MongoDB**: Conex√£o com pool de 10 conex√µes

## üéØ Status do Projeto

### ‚úÖ Implementado e Testado
- **API completa** em produ√ß√£o no Railway
- **CRUD de ve√≠culos** com valida√ß√£o e filtros
- **Sistema de vendas** com c√°lculo de comiss√µes
- **Autentica√ß√£o JWT** com roles e permiss√µes
- **Documenta√ß√£o Swagger** interativa
- **Deploy automatizado** via Railway
- **Health check** e monitoramento

### üîß Problemas Resolvidos
- **Encoding UTF-8**: Solucionado usando dados sem caracteres especiais
- **Build TypeScript**: Configurado com tsc-alias para path resolution
- **Valida√ß√£o de dados**: Schemas Joi implementados para todos endpoints
- **CORS**: Configurado para m√∫ltiplas origens
- **Rate limiting**: Prote√ß√£o contra spam implementada

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa ISC. Veja o arquivo `LICENSE` para mais detalhes.

## üë• Squad

- **Squad Backoffice** - Desenvolvimento e manuten√ß√£o da API
- **Tribe E-commerce** - Gest√£o do dom√≠nio completo

## üìû Suporte

Para suporte, entre em contato com a Squad Backoffice ou abra uma issue no reposit√≥rio.

---

**üöÄ API em Produ√ß√£o**: https://backoffice-veiculos-api-production.up.railway.app/
**üìö Documenta√ß√£o**: https://backoffice-veiculos-api-production.up.railway.app/docs
